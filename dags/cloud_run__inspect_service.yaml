group: cloud_run
tags: cloud_run
description: https://cloud.google.com/run/docs/quickstarts/build-and-deploy/deploy-python-service
env:
  - _NAMESPACE: cloud_run
  - _TARGET: inspect_service
  - _DAG_NAME: ${_NAMESPACE}__${_TARGET}
  - _DAG_WORK_DIR: ${_WORK_DIR}/${_DAG_NAME}
  - _TASK_FILE: ${_TASKS_DIR}/${_NAMESPACE}/${_TARGET}.yaml
params: >-
  GCP_PROJECT_ID=<gcp_project>
  USER_ACCOUNT=<identity_email>
  AUTHORIZATION_TOKEN=<authorization_token>
  CLOUD_RUN_SERVICE=<cloud_run_service>
  CLOUD_RUN_REGION=<cloud_run_region>
steps:
  - name: create_task_executor
    run: create_task_executor
    params: >-
      DAG_NAME=${_DAG_NAME}
      TASK_FILE=${_TASK_FILE}
  - name: activate_configuration
    dir: ${_DAG_WORK_DIR}
    command: >-
      run ${_DAG_NAME}
      activate_configuration
      "GCP_PROJECT_ID=${GCP_PROJECT_ID}
      USER_ACCOUNT=${USER_ACCOUNT}
      AUTHORIZATION_TOKEN=${AUTHORIZATION_TOKEN}
      CLOUD_RUN_SERVICE=${CLOUD_RUN_SERVICE}"
    depends:
      - create_task_executor
  - name: describe_service
    dir: ${_DAG_WORK_DIR}
    command: >-
      run ${_DAG_NAME}
      describe_service
      "GCP_PROJECT_ID=${GCP_PROJECT_ID}
      CLOUD_RUN_SERVICE=${CLOUD_RUN_SERVICE}
      CLOUD_RUN_REGION=${CLOUD_RUN_REGION}"
    depends:
      - activate_configuration
  - name: delete_configuration
    dir: ${_DAG_WORK_DIR}
    command: >-
      run ${_DAG_NAME}
      delete_configuration
      "GCP_PROJECT_ID=${GCP_PROJECT_ID}"
    depends:
      - describe_service